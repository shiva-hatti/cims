package com.iris.controller;

import java.text.ParseException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.Set;
import java.util.stream.Collectors;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.hibernate.service.spi.ServiceException;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.util.CollectionUtils;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestHeader;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.google.gson.Gson;
import com.iris.caching.ObjectCache;
import com.iris.dateutility.enums.DateConstants;
import com.iris.dateutility.util.DateManip;
import com.iris.dto.RetUploadDetBean;
import com.iris.dto.ServiceResponse;
import com.iris.dto.ServiceResponse.ServiceResponseBuilder;
import com.iris.exception.ApplicationException;
import com.iris.model.Category;
import com.iris.model.CategoryLabel;
import com.iris.model.EntityBean;
import com.iris.model.EntityLabelBean;
import com.iris.model.FilingStatus;
import com.iris.model.Frequency;
import com.iris.model.Return;
import com.iris.model.ReturnEntityMappingNew;
import com.iris.model.ReturnFileFormatMap;
import com.iris.model.ReturnLabel;
import com.iris.model.ReturnPropertyValue;
import com.iris.model.ReturnTemplate;
import com.iris.model.ReturnsUploadDetails;
import com.iris.model.RevisionRequest;
import com.iris.model.SubCategory;
import com.iris.model.SubCategoryLabel;
import com.iris.model.UnlockingRequest;
import com.iris.model.UploadChannel;
import com.iris.model.UserMaster;
import com.iris.model.UserRole;
import com.iris.model.WorkFlowMasterBean;
import com.iris.service.GenericService;
import com.iris.service.impl.ReturnEntityMapServiceNew;
import com.iris.util.UtilMaster;
import com.iris.util.Validations;
import com.iris.util.constant.ColumnConstants;
import com.iris.util.constant.ErrorCode;
import com.iris.util.constant.ErrorConstants;
import com.iris.util.constant.GeneralConstants;
import com.iris.util.constant.MethodConstants;

/**
 * @author Sajadhav
 */
@RestController
@RequestMapping("/service/returnsUploadDetailsController")
public class ReturnsUploadDetailsController {

	private static final String NO = "N";
	private static final String YES = "Y";
	private static final String ACTUALS = "ACTUALS";
	@Autowired
	private GenericService<ReturnsUploadDetails, Long> returnUploadDetailsService;
	@Autowired
	private ReturnEntityMapServiceNew returnEntityMapService;

	static final Logger LOGGER = LogManager.getLogger(ReturnsUploadDetailsController.class);

	@PostMapping(value = "/getFillingRecordsByStatus")
	public ServiceResponse getFillingRecordsByStatus(@RequestHeader("JobProcessingId") String jobProcessId,
			@RequestBody RetUploadDetBean retUploadDetBean) {
		try {
			LOGGER.info("Request received for Request trans Id " + jobProcessId);

			validateReturnsUploadDetailsObj(jobProcessId, retUploadDetBean);

			Map<String, Object> columnValueMap = new HashMap<>();
			columnValueMap.put(ColumnConstants.FILLING_STATUS_ID.getConstantVal(),
					Arrays.asList(retUploadDetBean.getFillingStatus()));
			columnValueMap.put(ColumnConstants.TOTAL_RECORD_COUNT.getConstantVal(),
					retUploadDetBean.getRecordCountToBeFetched());
			columnValueMap.put(ColumnConstants.FILE_TYPE.getConstantVal(),
					retUploadDetBean.getFileTypeList().stream().map(String::toUpperCase).collect(Collectors.toList()));
			if (CollectionUtils.isEmpty(retUploadDetBean.getSkipReturnCodeList())) {
				columnValueMap.put(ColumnConstants.RETURN_CODE.getConstantVal(), Arrays.asList("NOT_USED"));
			} else {
				columnValueMap.put(ColumnConstants.RETURN_CODE.getConstantVal(),
						retUploadDetBean.getSkipReturnCodeList());
			}

			List<ReturnsUploadDetails> returnUploadDetailsList = null;
			if (retUploadDetBean.getFillingStatusToBeChanged() != null) {
				columnValueMap.put(ColumnConstants.CHANGED_FILLING_STATUS_ID.getConstantVal(),
						retUploadDetBean.getFillingStatusToBeChanged());
				returnUploadDetailsList = returnUploadDetailsService.getDataByObject(columnValueMap,
						MethodConstants.GET_RETURNS_UPLOAD_DETALS_RECORD_BY_STATUS_AND_UPDATE_NEW_STATUS
						.getConstantVal());
			} else {
				returnUploadDetailsList = returnUploadDetailsService.getDataByObject(columnValueMap,
						MethodConstants.GET_RETURNS_UPLOAD_DETALS_RECORD_BY_STATUS_AND_TYPE.getConstantVal());
			}
			if (!CollectionUtils.isEmpty(returnUploadDetailsList)) {
				List<ReturnsUploadDetails> responseReturnUploadDetailList = prepareRetUploadDetBeanListResponse(
						returnUploadDetailsList, retUploadDetBean.getLangCode());
				LOGGER.info("Request successfully processed for Request trans Id " + jobProcessId);
				return new ServiceResponseBuilder().setStatus(true)
						.setStatusCode(GeneralConstants.RECORD_FETCHED_SUCCESSFULLY.getConstantVal())
						.setResponse(responseReturnUploadDetailList).build();
			} else {
				LOGGER.info("Empty record found for Request trans Id " + jobProcessId);
				return new ServiceResponseBuilder().setStatus(true)
						.setStatusCode(ErrorConstants.EMPTY_RECORD.getConstantVal())
						.setResponse(new ArrayList<ReturnsUploadDetails>()).build();
			}
		} catch (ApplicationException applicationException) {
			LOGGER.error(applicationException.getErrorMsg() + " for Transaction ID : " + jobProcessId);
			return new ServiceResponseBuilder().setStatus(false).setStatusCode(applicationException.getErrorCode())
					.setStatusMessage(applicationException.getErrorMsg()).build();
		} catch (Exception e) {
			LOGGER.error(ErrorConstants.ERROR_MSG_SERVICE.getConstantVal() + "Transaction ID : " + jobProcessId, e);
			return new ServiceResponseBuilder().setStatus(false).setStatusCode(ErrorCode.EC0013.toString())
					.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.EC0013.toString())).build();
		}
	}

	@PostMapping(value = "/getMisSubmitFilingEntityWise")
	public ServiceResponse getMisSubmitFilingEntityWise(@RequestHeader("JobProcessingId") String jobProcessId,
			@RequestBody RetUploadDetBean retUploadDetBean) {
		try {
			List<ReturnsUploadDetails> responseReturnUploadDetailList;
			if (UtilMaster.isEmpty(retUploadDetBean.getReturnIdList()) || retUploadDetBean.getEntityId() == null) {
				return new ServiceResponseBuilder().setStatus(false).setStatusCode(ErrorCode.E0757.toString())
						.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.E0757.toString())).build();
			}

			responseReturnUploadDetailList = uploadDetailsEntityWise(retUploadDetBean,GeneralConstants.MIS_REPORT_SUMITTED.getConstantVal());
			if (CollectionUtils.isEmpty(responseReturnUploadDetailList)) {
				return new ServiceResponseBuilder().setStatus(false).setStatusCode(ErrorCode.E0757.toString())
						.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.E0757.toString())).build();
			} else {
				List<ReturnsUploadDetails> responseReturnUploadDetailList1 = prepareRetSubmittedResponse(
						responseReturnUploadDetailList, retUploadDetBean.getLangCode());
				return new ServiceResponseBuilder().setStatus(true)
						.setStatusCode(GeneralConstants.RECORD_FETCHED_SUCCESSFULLY.getConstantVal())
						.setResponse(responseReturnUploadDetailList1).build();

			}
		} catch (Exception e) {
			LOGGER.error(ErrorConstants.ERROR_MSG_SERVICE.getConstantVal() + "Transaction ID : " + jobProcessId, e);
			return new ServiceResponseBuilder().setStatus(false).setStatusCode(ErrorCode.E0804.toString())
					.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.E0804.toString())).build();
		}
	}

	@PostMapping(value = "/getMisSubmitFilingReturnWise")
	public ServiceResponse getMisSubmitFilingReturnWise(@RequestHeader("JobProcessingId") String jobProcessId,
			@RequestBody RetUploadDetBean retUploadDetBean) {
		try {
			List<ReturnsUploadDetails> responseReturnUploadDetailList;
			if (UtilMaster.isEmpty(retUploadDetBean.getReturnIdList())
					|| UtilMaster.isEmpty(retUploadDetBean.getEntityIdList())) {
				return new ServiceResponseBuilder().setStatus(false).setStatusCode(ErrorCode.E0757.toString())
						.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.E0757.toString())).build();
			}

			responseReturnUploadDetailList = uploadDetailsReturnWise(retUploadDetBean,GeneralConstants.MIS_REPORT_SUMITTED.getConstantVal());
			if (CollectionUtils.isEmpty(responseReturnUploadDetailList)) {
				return new ServiceResponseBuilder().setStatus(true).setStatusCode(ErrorCode.E0757.toString())
						.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.E0757.toString())).build();
			} else {
				List<ReturnsUploadDetails> responseReturnUploadDetailList1 = prepareRetSubmittedResponse(
						responseReturnUploadDetailList, retUploadDetBean.getLangCode());
				return new ServiceResponseBuilder().setStatus(true)
						.setStatusCode(GeneralConstants.RECORD_FETCHED_SUCCESSFULLY.getConstantVal())
						.setResponse(responseReturnUploadDetailList1).build();
			}
		} catch (Exception e) {
			LOGGER.error(ErrorConstants.ERROR_MSG_SERVICE.getConstantVal() + "Transaction ID : " + jobProcessId, e);
			return new ServiceResponseBuilder().setStatus(false).setStatusCode(ErrorCode.E0804.toString())
					.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.E0804.toString())).build();
		}
	}

	@PostMapping(value = "/getMisPendingFilingReturnWise")
	public ServiceResponse getMisPendingFilingReturnWise(@RequestHeader("JobProcessingId") String jobProcessId,
			@RequestBody RetUploadDetBean retUploadDetBean) {
		try {
			List<ReturnsUploadDetails> responseReturnUploadDetailList;
			if (UtilMaster.isEmpty(retUploadDetBean.getReturnIdList())
					|| UtilMaster.isEmpty(retUploadDetBean.getEntityIdList())) {
				return new ServiceResponseBuilder().setStatus(false).setStatusCode(ErrorCode.E0757.toString())
						.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.E0757.toString())).build();
			}

			responseReturnUploadDetailList = uploadDetailsReturnWise(retUploadDetBean,GeneralConstants.MIS_REPORT_PENDING.getConstantVal());
			Map<Long, List<Long>> returnEntMap = new HashMap<>();
			Map<Long,List<String>> returnIdEndDatesListMap = retUploadDetBean.getReturnIdEndDateListMap();

			List<Long> retList = new ArrayList<>();
			for (String str : retUploadDetBean.getReturnIdList()) {
				retList.add(Long.valueOf(str));
			}
			List<Long> entList = new ArrayList<>();
			for (String str : retUploadDetBean.getEntityIdList()) {
				entList.add(Long.valueOf(str));
			}

			Map<String, Object> valueMap = new HashMap<>();
			valueMap.put(ColumnConstants.ENTITY_ID_LIST.getConstantVal(), entList);
			valueMap.put(ColumnConstants.RETURN_ID_LIST.getConstantVal(), retList);
			valueMap.put(ColumnConstants.FREQUENCY_ID.getConstantVal(), retUploadDetBean.getFinYearFreqDescId());
			List<ReturnEntityMappingNew> returnChannelMappingNewList = returnEntityMapService.getDataByObject(valueMap,
					MethodConstants.GET_RET_ENT_MAP_BY_ENT_RET.getConstantVal());
			if (CollectionUtils.isEmpty(returnChannelMappingNewList)) {
				return new ServiceResponseBuilder().setStatus(false).setStatusCode(ErrorCode.E0549.toString())
						.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.E0549.toString())).build();
			}
			for (ReturnEntityMappingNew returnEntityMappingNew : returnChannelMappingNewList) {
				List<Long> ent1List = returnEntMap.get(returnEntityMappingNew.getReturnObj().getReturnId());
				if (ent1List == null) {
					ent1List = new ArrayList<>();
					ent1List.add(returnEntityMappingNew.getEntity().getEntityId());
					returnEntMap.put(returnEntityMappingNew.getReturnObj().getReturnId(), ent1List);
				} else {
					ent1List.add(returnEntityMappingNew.getEntity().getEntityId());
					returnEntMap.put(returnEntityMappingNew.getReturnObj().getReturnId(), ent1List);
				}
			}

			Map<Long,Map<Date,List<Long>>> returnIdEndDateEntityList =new HashMap<>();
			for (Long retId : returnEntMap.keySet()) {

				List<Long> entIdList = returnEntMap.get(retId);
				//needs to add loop for end dates (Map<returnId,Map<endDate,listOfPendingEntity>)

				Map<Date,List<Long>> dateAndEntityIdListMap = new HashMap<>();

				List<ReturnsUploadDetails> filteredReturnUploadList = responseReturnUploadDetailList.stream()
						.filter(retUpDet -> entIdList.stream()
						.anyMatch(entId ->  retUpDet.getEntity().getEntityId().equals(entId)) && retUpDet.getReturnObj().getReturnId().equals(retId))
						.collect(Collectors.toList());

				List<String> endDatesInString = returnIdEndDatesListMap.get(retId);
				List<Long> entntIdList  = returnEntMap.get(retId);
				for(String endDateStr:endDatesInString) {
					Date endDate = DateManip.convertStringToDate(endDateStr, DateConstants.DD_MM_YYYY.getDateConstants());
					List<Long> tempEntIdList = new ArrayList<>();
					for(ReturnsUploadDetails returnsUploadDetails:filteredReturnUploadList) {						
						for(Long entId:returnEntMap.get(retId)) {
							if(entId.equals(returnsUploadDetails.getEntity().getEntityId()) && returnsUploadDetails.getEndDate().compareTo(endDate) == 0) {
								tempEntIdList.add(entId);
							} 
						}
					}
					for(Long entId:tempEntIdList) {
						entntIdList.remove(entId);
					}
					dateAndEntityIdListMap.put(endDate, entntIdList);
				}


				if (CollectionUtils.isEmpty(dateAndEntityIdListMap)) {
					dateAndEntityIdListMap = new HashMap<>();
					returnIdEndDateEntityList.put(retId, dateAndEntityIdListMap);
				} else {
					returnIdEndDateEntityList.put(retId, dateAndEntityIdListMap);
				}
			}
			// if NO any instance is submitted for that return id the all entity related to that return should be added into pending
			for (Long retId : returnEntMap.keySet()) {
				if(!returnIdEndDateEntityList.containsKey(retId)) {
					List<Long> entIdList = returnEntMap.get(retId);
					Map<Date,List<Long>> dateAndEntityIdListMap = new HashMap<>();
					List<String> endDatesInString = returnIdEndDatesListMap.get(retId);
					for(String endDateStr:endDatesInString) {
						Date endDate = DateManip.convertStringToDate(endDateStr, DateConstants.DD_MM_YYYY.getDateConstants());
						dateAndEntityIdListMap.put(endDate, entIdList);
					}
					returnIdEndDateEntityList.put(retId, dateAndEntityIdListMap);
				}
			}


			ReturnsUploadDetails returnUpload = null;
			List<ReturnsUploadDetails> responseReturnUploadDetailListPending = new ArrayList<>();

			Set<Long> retIds = returnIdEndDateEntityList.keySet();
			for (Long pendingRetId : retIds) {
				Map<Date,List<Long>> dateAndEntityIdListMap = returnIdEndDateEntityList.get(pendingRetId);
				Set<Date> allEndDates = dateAndEntityIdListMap.keySet();
				for (Date pendingEndDate : allEndDates) {
					List<Long> pendingEntityIdList = dateAndEntityIdListMap.get(pendingEndDate);
					if (!CollectionUtils.isEmpty(pendingEntityIdList)) {
						for (Long pendingEntId : pendingEntityIdList) {
							for (ReturnEntityMappingNew returnEntMapping : returnChannelMappingNewList) {
								if (pendingEntId.equals(returnEntMapping.getEntity().getEntityId()) && pendingRetId.equals(returnEntMapping.getReturnObj().getReturnId())) {
									returnUpload = new ReturnsUploadDetails();
									returnUpload.setReturnObj(returnEntMapping.getReturnObj());
									returnUpload.setEntity(returnEntMapping.getEntity());
									returnUpload.setFrequency(returnEntMapping.getReturnObj().getFrequency());
									returnUpload.setStartDate(pendingEndDate);
									returnUpload.setEndDate(pendingEndDate);
									returnUpload.setEndDateInLong(pendingEndDate.getTime());
									responseReturnUploadDetailListPending.add(returnUpload);
								}
							}
						}
					}
				}
			}

			List<ReturnsUploadDetails> responseReturnUploadDetailList1 = prepareRetPenDetBeanListResponse(
					responseReturnUploadDetailListPending, retUploadDetBean.getLangCode());
			return new ServiceResponseBuilder().setStatus(true)
					.setStatusCode(GeneralConstants.RECORD_FETCHED_SUCCESSFULLY.getConstantVal())
					.setResponse(responseReturnUploadDetailList1).build();
		} catch (Exception e) {
			LOGGER.error(ErrorConstants.ERROR_MSG_SERVICE.getConstantVal() + "Transaction ID : " + jobProcessId, e);
			return new ServiceResponseBuilder().setStatus(false).setStatusCode(ErrorCode.E0804.toString())
					.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.E0804.toString())).build();
		}
	}

	@PostMapping(value = "/getMisPendingFilingEntityWise")
	public ServiceResponse getMisPendingFilingEntityWise(@RequestHeader("JobProcessingId") String jobProcessId,
			@RequestBody RetUploadDetBean retUploadDetBean) {
		try {
			List<ReturnsUploadDetails> responseReturnUploadDetailList ;
			if (UtilMaster.isEmpty(retUploadDetBean.getReturnIdList()) || retUploadDetBean.getEntityId() == null) {
				return new ServiceResponseBuilder().setStatus(false).setStatusCode(ErrorCode.E0757.toString())
						.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.E0757.toString())).build();
			}

			responseReturnUploadDetailList = uploadDetailsEntityWise(retUploadDetBean,GeneralConstants.MIS_REPORT_PENDING.getConstantVal());
			List<Long> submittedRetrunIdList = new ArrayList<>();
			if (!CollectionUtils.isEmpty(responseReturnUploadDetailList)) {
				for (ReturnsUploadDetails returnUpDetails : responseReturnUploadDetailList) {
					if (!submittedRetrunIdList.contains(returnUpDetails.getReturnObj().getReturnId())) {
						submittedRetrunIdList.add(returnUpDetails.getReturnObj().getReturnId());
					}
				}
			}

			List<Long> retList = new ArrayList<>();
			for (String str : retUploadDetBean.getReturnIdList()) {
				retList.add(Long.valueOf(str));
			}

			Map<String, Object> valueMap = new HashMap<>();
			List<Long> entIdList = new ArrayList<>();
			entIdList.add(retUploadDetBean.getEntityId());
			valueMap.put(ColumnConstants.ENTITY_ID_LIST.getConstantVal(), entIdList);
			valueMap.put(ColumnConstants.RETURN_ID_LIST.getConstantVal(), retList);
			valueMap.put(ColumnConstants.FREQUENCY_ID.getConstantVal(), retUploadDetBean.getFinYearFreqDescId());
			valueMap.put(ColumnConstants.END_DATE_LIST.getConstantVal(), retUploadDetBean.getEndDateList());

			List<ReturnEntityMappingNew> returnChannelMappingNewList;
			if (!CollectionUtils.isEmpty(submittedRetrunIdList)) {
				valueMap.put(ColumnConstants.SUB_RET_ID_LIST.getConstantVal(), submittedRetrunIdList);
				returnChannelMappingNewList = returnEntityMapService.getDataByObject(valueMap,
						MethodConstants.GET_RET_ENT_MAP_BY_ENT_RET_FREQ_WITH_SUBRET.getConstantVal());
			} else {
				returnChannelMappingNewList = returnEntityMapService.getDataByObject(valueMap,
						MethodConstants.GET_RET_ENT_MAP_BY_ENT_RET_FREQ.getConstantVal());
			}

			if (CollectionUtils.isEmpty(returnChannelMappingNewList)) {
				return new ServiceResponseBuilder().setStatus(false).setStatusCode(ErrorCode.E0825.toString())
						.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.E0825.toString())).build();
			}

			List<ReturnsUploadDetails> responseReturnUploadDetailListPending ;
			responseReturnUploadDetailListPending=prepareNewPendingListAsPerPeriod(responseReturnUploadDetailList, retUploadDetBean.getEndDateList(), returnChannelMappingNewList);

			List<ReturnsUploadDetails> responseReturnUploadDetailList1 = prepareRetPenDetBeanListResponse(
					responseReturnUploadDetailListPending, retUploadDetBean.getLangCode());
			return new ServiceResponseBuilder().setStatus(true)
					.setStatusCode(GeneralConstants.RECORD_FETCHED_SUCCESSFULLY.getConstantVal())
					.setResponse(responseReturnUploadDetailList1).build();
		} catch (Exception e) {
			LOGGER.error(ErrorConstants.ERROR_MSG_SERVICE.getConstantVal() + "Transaction ID : " + jobProcessId, e);
			return new ServiceResponseBuilder().setStatus(false).setStatusCode(ErrorCode.E0804.toString())
					.setStatusMessage(ObjectCache.getErrorCodeKey(ErrorCode.E0804.toString())).build();
		}
	}

	public List<ReturnsUploadDetails> prepareNewPendingListAsPerPeriod(List<ReturnsUploadDetails> submittedListReturnUploadDetailList,List<String> endDates,List<ReturnEntityMappingNew> returnChannelMappingNewList) throws ParseException {

		List<ReturnsUploadDetails> pendingList = new ArrayList<>();
		try {
			List<Date> tempDates = null;
			List<Date> allEndDates = new ArrayList<>();
			for(String endDate:endDates) {
				Date tempEndDate=DateManip.convertStringToDate(endDate, DateConstants.DD_MM_YYYY.getDateConstants());
				allEndDates.add(tempEndDate);
			}

			for(ReturnEntityMappingNew returnEntityMappingNew:returnChannelMappingNewList) {
				Long returnId=returnEntityMappingNew.getReturnId();

				if(submittedListReturnUploadDetailList != null && !submittedListReturnUploadDetailList.isEmpty()) {
					for(ReturnsUploadDetails returnsUploadDetails:submittedListReturnUploadDetailList) {
						tempDates = new ArrayList<>();
						for(Date tempEndDate:allEndDates) {
							tempDates.add(tempEndDate);
							if(tempEndDate.equals(returnsUploadDetails.getEndDate()) && returnsUploadDetails.getReturnObj().getReturnId().equals(returnId)) {
								tempDates.remove(tempEndDate);
							}
						}

					}
				} else {
					tempDates = new ArrayList<>();
					for(String endDate:endDates) {
						Date tempEndDate=DateManip.convertStringToDate(endDate, DateConstants.DD_MM_YYYY.getDateConstants());
						tempDates.add(tempEndDate);
					}
				}
				//for Remaining dates filing is not done so preparing data for those dates 
				for(Date tempDate:tempDates) {
					ReturnsUploadDetails returnUpload;
					returnUpload = new ReturnsUploadDetails();
					returnUpload.setReturnObj(returnEntityMappingNew.getReturnObj());
					returnUpload.setEntity(returnEntityMappingNew.getEntity());
					returnUpload.setFrequency(returnEntityMappingNew.getReturnObj().getFrequency());
					returnUpload.setStartDate(tempDate);
					returnUpload.setEndDate(tempDate);
					pendingList.add(returnUpload);
				}
			}


		} catch (com.iris.exception.ServiceException e) {
			throw e;
		} 
		return pendingList;
	}

	private List<ReturnsUploadDetails> uploadDetailsEntityWise(RetUploadDetBean returnsUploadDetailsObj,String misReportType)
			throws ServiceException, ParseException, ServiceException {
		try {
			Map<String, List<String>> valueMap = new HashMap<>();
			List<String> valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getEntityId() + "");
			valueMap.put(ColumnConstants.ENTITYID.getConstantVal(), valueList);
			Date startDate = DateManip.convertStringToDate(returnsUploadDetailsObj.getStartDate(),
					returnsUploadDetailsObj.getSessionDateFormat());
			String inputDatStr = DateManip.convertDateToString(startDate, DateConstants.DD_MM_YYYY.getDateConstants());
			returnsUploadDetailsObj.setStartDate(inputDatStr);
			Date endDate = DateManip.convertStringToDate(returnsUploadDetailsObj.getEndDate(),
					returnsUploadDetailsObj.getSessionDateFormat());
			String inputEnDatStr = DateManip.convertDateToString(endDate, DateConstants.DD_MM_YYYY.getDateConstants());
			returnsUploadDetailsObj.setEndDate(inputEnDatStr);
			valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getStartDate() + "");
			valueMap.put(ColumnConstants.STARTDATE.getConstantVal(), valueList);

			valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getEndDate() + "");
			valueMap.put(ColumnConstants.ENDDATE.getConstantVal(), valueList);

			valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getFinYearFreqDescId() + "");
			valueMap.put(ColumnConstants.FIN_YEAR_FREQ_DESC_ID.getConstantVal(), valueList);

			valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getReturnIdList() + "");
			valueMap.put(ColumnConstants.RETURN_ID_LIST.getConstantVal(), returnsUploadDetailsObj.getReturnIdList());

			valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getEntityIdList() + "");
			valueMap.put(ColumnConstants.ENTITY_ID_LIST.getConstantVal(), returnsUploadDetailsObj.getEntityIdList());

			valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getReturnPropertyValId() + "");
			valueMap.put(ColumnConstants.RETURN_PROPERTY_VAL_ID.getConstantVal(), valueList);

			if(misReportType.equals(GeneralConstants.MIS_REPORT_PENDING.getConstantVal())) {
				valueList = new ArrayList<>();
				valueList.add(returnsUploadDetailsObj.getEndDateList() + "");
				valueMap.put(ColumnConstants.END_DATE_LIST.getConstantVal(), returnsUploadDetailsObj.getEndDateList());
			}

			return returnUploadDetailsService.getDataByColumnValue(valueMap,
					MethodConstants.GET_RETURN_UPLOAD_DETAILS_BY_ENTITY_WISE.getConstantVal());

		} catch (com.iris.exception.ServiceException e) {
			throw e;
		}
	}

	private List<ReturnsUploadDetails> uploadDetailsReturnWise(RetUploadDetBean returnsUploadDetailsObj,String misReportType)
			throws ServiceException, ParseException, ServiceException {
		try {

			Map<String, List<String>> valueMap = new HashMap<>();
			List<String> valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getReturnIdList() + "");
			valueMap.put(ColumnConstants.RETURN_ID_LIST.getConstantVal(), returnsUploadDetailsObj.getReturnIdList());
			Date startDate = DateManip.convertStringToDate(returnsUploadDetailsObj.getStartDate(),
					returnsUploadDetailsObj.getSessionDateFormat());
			String inputDatStr = DateManip.convertDateToString(startDate, DateConstants.DD_MM_YYYY.getDateConstants());
			returnsUploadDetailsObj.setStartDate(inputDatStr);
			Date endDate = DateManip.convertStringToDate(returnsUploadDetailsObj.getEndDate(),
					returnsUploadDetailsObj.getSessionDateFormat());
			String inputEnDatStr = DateManip.convertDateToString(endDate, DateConstants.DD_MM_YYYY.getDateConstants());
			returnsUploadDetailsObj.setEndDate(inputEnDatStr);
			valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getStartDate() + "");
			valueMap.put(ColumnConstants.STARTDATE.getConstantVal(), valueList);

			valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getEndDate() + "");
			valueMap.put(ColumnConstants.ENDDATE.getConstantVal(), valueList);

			valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getFinYearFreqDescId() + "");
			valueMap.put(ColumnConstants.FIN_YEAR_FREQ_DESC_ID.getConstantVal(), valueList);

			valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getEntityIdList() + "");
			valueMap.put(ColumnConstants.ENTITY_ID_LIST.getConstantVal(), returnsUploadDetailsObj.getEntityIdList());

			valueList = new ArrayList<>();
			valueList.add(returnsUploadDetailsObj.getReturnPropertyValId() + "");
			valueMap.put(ColumnConstants.RETURN_PROPERTY_VAL_ID.getConstantVal(), valueList);

			valueList = new ArrayList<>();
			valueList.add(misReportType);
			valueMap.put(ColumnConstants.MIS_REPORT_TYPE.getConstantVal(), valueList);

			if(misReportType.equals(GeneralConstants.MIS_REPORT_PENDING.getConstantVal())) {
				valueList = new ArrayList<>();
				valueList.add(returnsUploadDetailsObj.getEndDateList() + "");
				valueMap.put(ColumnConstants.END_DATE_LIST.getConstantVal(), returnsUploadDetailsObj.getEndDateList());
			}

			return returnUploadDetailsService.getDataByColumnValue(valueMap,
					MethodConstants.GET_RETURN_UPLOAD_DETAILS_BY_RETURN_WISE.getConstantVal());

		} catch (com.iris.exception.ServiceException e) {
			throw e;
		}
	}

	private void validateReturnsUploadDetailsObj(String requestTxnId, RetUploadDetBean retUploadDetBean)
			throws ApplicationException {
		String errorMessage = "";

		if (UtilMaster.isEmpty(requestTxnId)) {
			errorMessage = ErrorConstants.REQUEST_TRANSACTION_ID_NOT_FOUND.getConstantVal();
		}

		if (UtilMaster.isEmpty(retUploadDetBean.getFillingStatus())) {
			if (errorMessage.equals("")) {
				errorMessage = ErrorConstants.FILLING_STATUS_NOT_FOUND.getConstantVal();
			} else {
				errorMessage = errorMessage + ", " + ErrorConstants.FILLING_STATUS_NOT_FOUND.getConstantVal();
			}
		}

		if (UtilMaster.isEmpty(retUploadDetBean.getRecordCountToBeFetched())) {
			if (errorMessage.equals("")) {
				errorMessage = ErrorConstants.RECORD_COUNT_NOT_FOUND.getConstantVal();
			} else {
				errorMessage = errorMessage + ", " + ErrorConstants.RECORD_COUNT_NOT_FOUND.getConstantVal();
			}
		} else {
			if (retUploadDetBean.getRecordCountToBeFetched() <= 0) {
				if (errorMessage.equals("")) {
					errorMessage = ErrorConstants.RECORD_COUNT_SHOULD_BE_GREATER_THAN_0.getConstantVal();
				} else {
					errorMessage = errorMessage + ", "
							+ ErrorConstants.RECORD_COUNT_SHOULD_BE_GREATER_THAN_0.getConstantVal();
				}
			}
		}

		if (UtilMaster.isEmpty(retUploadDetBean.getFileTypeList())) {
			if (errorMessage.equals("")) {
				errorMessage = ErrorConstants.FILE_TYPE_LIST_NOT_FOUND.getConstantVal();
			} else {
				errorMessage = errorMessage + ", " + ErrorConstants.FILE_TYPE_LIST_NOT_FOUND.getConstantVal();
			}
		}
		if (UtilMaster.isEmpty(retUploadDetBean.getLangCode())) {
			if (errorMessage.equals("")) {
				errorMessage = ErrorConstants.LANGUAG_CODE_NOT_FOUND.getConstantVal();
			} else {
				errorMessage = errorMessage + ", " + ErrorConstants.LANGUAG_CODE_NOT_FOUND.getConstantVal();
			}
		}

		if (!errorMessage.equals("")) {
			throw new ApplicationException(ErrorCode.EC0391.toString(),
					ObjectCache.getErrorCodeKey(ErrorCode.EC0391.toString()));
		}
	}

	private List<ReturnsUploadDetails> prepareRetPenDetBeanListResponse(
			List<ReturnsUploadDetails> returnUploadDetailsList, String langCode) {
		List<ReturnsUploadDetails> responseRetUploadDetBeanList = new ArrayList<>();

		for (ReturnsUploadDetails returnsUploadDetails : returnUploadDetailsList) {
			ReturnsUploadDetails responseRetUploadDetBean = new ReturnsUploadDetails();

			Return returnDto = new Return();

			ReturnLabel returnLabel = returnsUploadDetails.getReturnObj().getReturnLblSet().stream()
					.filter(f -> f.getLangIdFk().getLanguageCode().equalsIgnoreCase(langCode)).findAny().orElse(null);
			returnDto.setReturnCode(returnsUploadDetails.getReturnObj().getReturnCode());
			returnDto.setReturnId(returnsUploadDetails.getReturnObj().getReturnId());
			if (returnLabel != null) {
				returnDto.setReturnName(returnLabel.getReturnLabel());
			} else {
				returnDto.setReturnName(returnsUploadDetails.getReturnObj().getReturnName());
			}

			responseRetUploadDetBean.setReturnObj(returnDto);

			EntityBean entityDto = new EntityBean();

			EntityLabelBean entityLabelBean = returnsUploadDetails.getEntity().getEntityLabelSet().stream()
					.filter(f -> f.getLanguageMaster().getLanguageCode().equalsIgnoreCase(langCode)).findAny()
					.orElse(null);
			entityDto.setEntityId(returnsUploadDetails.getEntity().getEntityId());
			entityDto.setEntityCode(returnsUploadDetails.getEntity().getEntityCode());
			if (entityLabelBean != null) {
				entityDto.setEntityName(entityLabelBean.getEntityNameLabel());
			} else {
				entityDto.setEntityName(returnsUploadDetails.getEntity().getEntityName());
			}

			Category categoryDto = new Category();
			CategoryLabel cagtegoryLabel = returnsUploadDetails.getEntity().getCategory().getCatLblSet().stream()
					.filter(f -> f.getLangIdFk().getLanguageCode().equalsIgnoreCase(langCode)).findAny().orElse(null);
			if (cagtegoryLabel != null) {
				categoryDto.setCategoryName(cagtegoryLabel.getCategoryLabel());
			} else {
				categoryDto.setCategoryName(returnsUploadDetails.getEntity().getCategory().getCategoryName());
			}
			categoryDto.setCategoryCode(returnsUploadDetails.getEntity().getCategory().getCategoryCode());
			entityDto.setCategory(categoryDto);

			SubCategory subCatDto = new SubCategory();
			SubCategoryLabel subLabel = returnsUploadDetails.getEntity().getSubCategory().getSubCatLblSet().stream()
					.filter(f -> f.getLangIdFk().getLanguageCode().equalsIgnoreCase(langCode)).findAny().orElse(null);
			if (subLabel != null) {
				subCatDto.setSubCategoryName(subLabel.getSubCategoryLabel());
			} else {
				subCatDto.setSubCategoryName(returnsUploadDetails.getEntity().getSubCategory().getSubCategoryName());
			}
			subCatDto.setSubCategoryCode(returnsUploadDetails.getEntity().getSubCategory().getSubCategoryCode());
			entityDto.setSubCategory(subCatDto);

			Frequency frequeDto = new Frequency();
			frequeDto.setFrequencyId(returnsUploadDetails.getFrequency().getFrequencyId());
			frequeDto.setFrequencyName(returnsUploadDetails.getFrequency().getFrequencyName());
			responseRetUploadDetBean.setFrequency(frequeDto);

			responseRetUploadDetBean.setEntity(entityDto);
			responseRetUploadDetBean.setStartDate(returnsUploadDetails.getStartDate());
			responseRetUploadDetBean.setEndDate(returnsUploadDetails.getEndDate());
			responseRetUploadDetBean.setEndDateInLong(returnsUploadDetails.getEndDate().getTime());
			responseRetUploadDetBeanList.add(responseRetUploadDetBean);
		}
		return responseRetUploadDetBeanList;
	}

	private List<ReturnsUploadDetails> prepareRetUploadDetBeanListResponse(
			List<ReturnsUploadDetails> returnUploadDetailsList, String langCode) {
		List<ReturnsUploadDetails> responseRetUploadDetBeanList = new ArrayList<>();

		for (ReturnsUploadDetails returnsUploadDetails : returnUploadDetailsList) {
			ReturnsUploadDetails responseRetUploadDetBean = new ReturnsUploadDetails();
			responseRetUploadDetBean.setUploadedDate(returnsUploadDetails.getUploadedDate());
			responseRetUploadDetBean.setUploadId(returnsUploadDetails.getUploadId());
			responseRetUploadDetBean.setStartDate(returnsUploadDetails.getStartDate());
			responseRetUploadDetBean.setEndDate(returnsUploadDetails.getEndDate());
			responseRetUploadDetBean.setStartDateInLong(returnsUploadDetails.getStartDate().getTime());
			responseRetUploadDetBean.setEndDateInLong(returnsUploadDetails.getEndDate().getTime());
			if (!Objects.isNull(returnsUploadDetails.getFileDetailsBean())) {
				responseRetUploadDetBean
				.setApplicationProcessId(returnsUploadDetails.getFileDetailsBean().getApplicationProcessId());

				if (returnsUploadDetails.getFileDetailsBean().getCreationDate() != null) {
					responseRetUploadDetBean
					.setUploadedOnInLong(returnsUploadDetails.getFileDetailsBean().getCreationDate().getTime());
				}
			}
			responseRetUploadDetBean.setNillable(returnsUploadDetails.isNillable());
			if (!UtilMaster.isEmpty(returnsUploadDetails.getNillableComments())) {
				responseRetUploadDetBean.setNillableComments(returnsUploadDetails.getNillableComments());
			}
			Frequency frequeDto = new Frequency();
			frequeDto.setFrequencyId(returnsUploadDetails.getFrequency().getFrequencyId());
			frequeDto.setFrequencyName(ObjectCache.getLabelKeyValue("en", returnsUploadDetails.getFrequency().getFrequencyName()));
			frequeDto.setFrequencyCode(returnsUploadDetails.getFrequency().getFrequencyCode());
			responseRetUploadDetBean.setFrequency(frequeDto);

			Return returnDto = new Return();
			returnDto.setReturnId(returnsUploadDetails.getReturnObj().getReturnId());
			returnDto.setReturnCode(returnsUploadDetails.getReturnObj().getReturnCode());

			ReturnLabel returnLabel = returnsUploadDetails.getReturnObj().getReturnLblSet().stream()
					.filter(f -> f.getLangIdFk().getLanguageCode().equalsIgnoreCase(langCode)).findAny().orElse(null);

			if (returnLabel != null) {
				returnDto.setReturnName(returnLabel.getReturnLabel());
			} else {
				returnDto.setReturnName(returnsUploadDetails.getReturnObj().getReturnName());
			}

			if (returnsUploadDetails.getReturnObj().getErrorCodeBeauJsonObj() != null) {
				returnDto.setErrorCodeBeauJson(
						returnsUploadDetails.getReturnObj().getErrorCodeBeauJsonObj().getBeauJson());
			}

			List<ReturnFileFormatMap> returnFileFormatList = null;
			if (!CollectionUtils.isEmpty(returnsUploadDetails.getReturnObj().getReturnFileFormatMapList())) {
				returnFileFormatList = new ArrayList<>();
				for (ReturnFileFormatMap returnFileFormatMap : returnsUploadDetails.getReturnObj()
						.getReturnFileFormatMapList()) {
					ReturnFileFormatMap retFileFormatMap = new ReturnFileFormatMap();
					retFileFormatMap.setFileFormat(returnFileFormatMap.getFileFormat());
					retFileFormatMap.setJsonToReadFile(returnFileFormatMap.getJsonToReadFile());
					retFileFormatMap.setFormulaFileName(returnFileFormatMap.getFormulaFileName());
					returnFileFormatList.add(retFileFormatMap);
				}
				returnDto.setReturnFileFormatMapList(returnFileFormatList);
			}
			responseRetUploadDetBean.setReturnObj(returnDto);

			UploadChannel uploadChDto = new UploadChannel();
			uploadChDto.setUploadChannelId(returnsUploadDetails.getFileDetailsBean() != null ? returnsUploadDetails.getFileDetailsBean().getUploadChannelIdFk().getUploadChannelId() : -1L);
			uploadChDto.setUploadChannelDesc(returnsUploadDetails.getFileDetailsBean() != null ? ObjectCache.getLabelKeyValue("en", returnsUploadDetails.getFileDetailsBean().getUploadChannelIdFk().getUploadChannelDesc()) : "NA");
			responseRetUploadDetBean.setUploadChannel(uploadChDto);

			EntityBean entityDto = new EntityBean();
			entityDto.setEntityId(returnsUploadDetails.getEntity().getEntityId());
			entityDto.setEntityName(returnsUploadDetails.getEntity().getEntityName());
			entityDto.setEntityCode(returnsUploadDetails.getEntity().getEntityCode());

			Category categoryDto = new Category();
			categoryDto.setCategoryCode(returnsUploadDetails.getEntity().getCategory().getCategoryCode());
			categoryDto.setCategoryName(returnsUploadDetails.getEntity().getCategory().getCategoryName());
			entityDto.setCategory(categoryDto);

			SubCategory subCatDto = new SubCategory();
			subCatDto.setSubCategoryCode(returnsUploadDetails.getEntity().getSubCategory().getSubCategoryCode());
			subCatDto.setSubCategoryName(returnsUploadDetails.getEntity().getSubCategory().getSubCategoryName());
			entityDto.setSubCategory(subCatDto);

			responseRetUploadDetBean.setEntity(entityDto);

			UserMaster userDto = new UserMaster();
			userDto.setUserId(returnsUploadDetails.getUploadedBy().getUserId());
			userDto.setUserName(returnsUploadDetails.getUploadedBy().getUserName());
			responseRetUploadDetBean.setUploadedBy(userDto);

			if (returnsUploadDetails.getUnlockingReqId() != null) {
				UnlockingRequest unlockRequestDto = new UnlockingRequest();
				unlockRequestDto.setUnlockingReqId(returnsUploadDetails.getUnlockingReqId().getUnlockingReqId());
				unlockRequestDto.setUnlockStatus(returnsUploadDetails.getUnlockingReqId().getUnlockStatus());
				responseRetUploadDetBean.setUnlockingReqId(unlockRequestDto);
			}

			if (returnsUploadDetails.getRevisionRequestId() != null) {
				RevisionRequest revisionRequestDto = new RevisionRequest();
				revisionRequestDto
				.setRevisionRequestId(returnsUploadDetails.getRevisionRequestId().getRevisionRequestId());
				revisionRequestDto.setRevisionStatus(returnsUploadDetails.getRevisionRequestId().getReasonForRequest());
				responseRetUploadDetBean.setRevisionRequestId(revisionRequestDto);
			}

			responseRetUploadDetBean.setInstanceFile(returnsUploadDetails.getInstanceFile());

			if (returnsUploadDetails.getTaxonomyId() != null) {
				ReturnTemplate taxonomy = new ReturnTemplate();
				taxonomy.setReturnTemplateId(returnsUploadDetails.getTaxonomyId().getReturnTemplateId());
				taxonomy.setVersionDesc(returnsUploadDetails.getTaxonomyId().getVersionDesc());
				taxonomy.setVersionNumber(returnsUploadDetails.getTaxonomyId().getVersionNumber());
				taxonomy.setXsdFileName(returnsUploadDetails.getTaxonomyId().getXsdFileName());
				taxonomy.setTaxonomyName(returnsUploadDetails.getTaxonomyId().getTaxonomyName());
				taxonomy.setFormulaFileName(returnsUploadDetails.getTaxonomyId().getFormulaFileName());
				taxonomy.setJsonDataFileName(returnsUploadDetails.getTaxonomyId().getJsonDataFileName());
				responseRetUploadDetBean.setTaxonomyId(taxonomy);
			}

			if (returnsUploadDetails.getUploadUsrRole() != null) {
				UserRole userRole = new UserRole();
				userRole.setUserRoleId(returnsUploadDetails.getUploadUsrRole().getRoleIdKey());
				userRole.setRoleDesc(returnsUploadDetails.getUploadUsrRole().getRoleDesc());
				userRole.setUserRoleId(returnsUploadDetails.getUploadUsrRole().getUserRoleId());
				responseRetUploadDetBean.setUploadUsrRole(userRole);
			}

			responseRetUploadDetBean.setFileType(returnsUploadDetails.getFileType());

			WorkFlowMasterBean workflow = new WorkFlowMasterBean();
			workflow.setWorkflowId(returnsUploadDetails.getWorkFlowMaster().getWorkflowId());
			workflow.setWorkFlowJson(returnsUploadDetails.getWorkFlowMaster().getWorkFlowJson());

			responseRetUploadDetBean.setWorkFlowMaster(workflow);

			ReturnPropertyValue returnPropertyValue = new ReturnPropertyValue();
			returnPropertyValue.setReturnProprtyValId(returnsUploadDetails.getReturnPropertyValue() != null ? returnsUploadDetails.getReturnPropertyValue().getReturnProprtyValId() : -1);
			returnPropertyValue.setReturnProValue(returnsUploadDetails.getReturnPropertyValue() != null ? returnsUploadDetails.getReturnPropertyValue().getReturnProValue() : "NA");
			responseRetUploadDetBean.setReturnPropertyValue(returnPropertyValue);

			FilingStatus filingStatus = new FilingStatus();
			filingStatus.setFilingStatusId(returnsUploadDetails.getFilingStatus().getFilingStatusId());
			filingStatus.setStatus(ObjectCache.getLabelKeyValue("en", returnsUploadDetails.getFilingStatus().getStatus()));
			responseRetUploadDetBean.setFilingStatus(filingStatus);

			Map<String, String> filingDetailObj = prepareFilingDetails(responseRetUploadDetBean);
			responseRetUploadDetBean.setFilingDetailObj(filingDetailObj);

			responseRetUploadDetBeanList.add(responseRetUploadDetBean);
		}

		return responseRetUploadDetBeanList;
	}

	public static enum FilingDetailsEnum {
		filingNumber, filingStatus, filingStatusId, returnCode, returnName, returnId, entityCode, entityId, entityName,
		reportingStartDate, uploadedDate, reportingEndDate, auditFlag, provisionalFlag, uploadChannel, frequncyId,
		frequncyCode, frequencyName, taxonomyVersion, nillable, nillableComments, fileType, reportingCurrency,
		bankworkingCode, unitRef;
	}

	public Map<String, String> prepareFilingDetails(ReturnsUploadDetails returnsUploadDetails) {

		String endDate = null;
		String startDate = null;

		startDate = "";
		if (returnsUploadDetails.getStartDateInLong() != null) {
			startDate = DateManip.convertDateToString(new Date(returnsUploadDetails.getStartDateInLong()), DateConstants.YYYY_MM_DD.getDateConstants());
		}
		endDate = "";
		if (returnsUploadDetails.getEndDateInLong() != null) {
			endDate = DateManip.convertDateToString(new Date(returnsUploadDetails.getEndDateInLong()), DateConstants.YYYY_MM_DD.getDateConstants());
		}
		String uploadedDate = DateManip.convertDateToString(new Date(returnsUploadDetails.getUploadedOnInLong()), DateConstants.YYYY_MM_DD.getDateConstants() + " " + DateConstants.HH_MM_SS.getDateConstants());
		Map<String, String> filingDetails = new HashMap<>();
		filingDetails.put(FilingDetailsEnum.filingNumber.toString(), returnsUploadDetails.getUploadId().toString());
		filingDetails.put(FilingDetailsEnum.filingStatusId.toString(), ""+returnsUploadDetails.getFilingStatus().getFilingStatusId());
		filingDetails.put(FilingDetailsEnum.returnCode.toString(), returnsUploadDetails.getReturnObj().getReturnCode()); //R023, PDR2 monthly //R022, PDR4, MIS, OSS4, ROR quarterly //RDB weekly
		filingDetails.put(FilingDetailsEnum.returnId.toString(), returnsUploadDetails.getReturnObj().getReturnId().toString());
		filingDetails.put(FilingDetailsEnum.entityCode.toString(), returnsUploadDetails.getEntity().getEntityCode());
		filingDetails.put(FilingDetailsEnum.entityId.toString(), returnsUploadDetails.getEntity().getEntityId().toString());
		filingDetails.put(FilingDetailsEnum.reportingStartDate.toString(), startDate);//01012016 01032016 01062018 01012019 01072016 19012019
		filingDetails.put(FilingDetailsEnum.reportingEndDate.toString(), endDate);//31032016	31032016 30062018 31032019 30092016 25012019
		filingDetails.put(FilingDetailsEnum.frequncyId.toString(), returnsUploadDetails.getFrequency().getFrequencyId().toString());
		filingDetails.put(FilingDetailsEnum.frequncyCode.toString(), returnsUploadDetails.getFrequency().getFrequencyCode());
		filingDetails.put(FilingDetailsEnum.frequencyName.toString(), returnsUploadDetails.getFrequency().getFrequencyName());
		filingDetails.put(FilingDetailsEnum.taxonomyVersion.toString(), "1.0.0");
		filingDetails.put(FilingDetailsEnum.auditFlag.toString(), returnsUploadDetails.getReturnPropertyValue().getReturnProprtyValId().toString());
		filingDetails.put(FilingDetailsEnum.uploadChannel.toString(), returnsUploadDetails.getUploadChannel().getUploadChannelDesc());
		filingDetails.put(FilingDetailsEnum.nillable.toString(), returnsUploadDetails.isNillable() ? YES : NO);
		filingDetails.put(FilingDetailsEnum.nillableComments.toString(), returnsUploadDetails.getNillableComments() == null ? "" : returnsUploadDetails.getNillableComments());
		filingDetails.put(FilingDetailsEnum.returnName.toString(), returnsUploadDetails.getReturnObj().getReturnName());
		filingDetails.put(FilingDetailsEnum.entityName.toString(), returnsUploadDetails.getEntity().getEntityName());
		filingDetails.put(FilingDetailsEnum.unitRef.toString(), ACTUALS);
		filingDetails.put(FilingDetailsEnum.uploadedDate.toString(), uploadedDate);
		filingDetails.put(FilingDetailsEnum.fileType.toString(), returnsUploadDetails.getFileType() != null ? returnsUploadDetails.getFileType().toUpperCase() : "");
		return filingDetails;
	}

	private List<ReturnsUploadDetails> prepareRetSubmittedResponse(List<ReturnsUploadDetails> returnUploadDetailsList, String langCode) {
		List<ReturnsUploadDetails> responseRetUploadDetBeanList = new ArrayList<>();

		for (ReturnsUploadDetails returnsUploadDetails : returnUploadDetailsList) {
			ReturnsUploadDetails responseRetUploadDetBean = new ReturnsUploadDetails();
			responseRetUploadDetBean.setUploadedDate(returnsUploadDetails.getUploadedDate());
			responseRetUploadDetBean.setUploadId(returnsUploadDetails.getUploadId());
			responseRetUploadDetBean.setStartDate(returnsUploadDetails.getStartDate());
			responseRetUploadDetBean.setEndDate(returnsUploadDetails.getEndDate());
			responseRetUploadDetBean.setStartDateInLong(returnsUploadDetails.getStartDate().getTime());
			responseRetUploadDetBean.setEndDateInLong(returnsUploadDetails.getEndDate().getTime());
			responseRetUploadDetBean.setApplicationProcessId(returnsUploadDetails.getFileDetailsBean().getApplicationProcessId());
			responseRetUploadDetBean.setNillable(returnsUploadDetails.isNillable());
			if (!UtilMaster.isEmpty(returnsUploadDetails.getNillableComments())) {
				responseRetUploadDetBean.setNillableComments(returnsUploadDetails.getNillableComments());
			}
			Frequency frequeDto = new Frequency();
			frequeDto.setFrequencyId(returnsUploadDetails.getFrequency().getFrequencyId());
			frequeDto.setFrequencyName(returnsUploadDetails.getFrequency().getFrequencyName());
			responseRetUploadDetBean.setFrequency(frequeDto);
			responseRetUploadDetBean.setInstanceFile(returnsUploadDetails.getInstanceFile());
			Return returnDto = new Return();
			returnDto.setReturnId(returnsUploadDetails.getReturnObj().getReturnId());
			returnDto.setReturnCode(returnsUploadDetails.getReturnObj().getReturnCode());

			ReturnLabel returnLabel = returnsUploadDetails.getReturnObj().getReturnLblSet().stream().filter(f -> f.getLangIdFk().getLanguageCode().equalsIgnoreCase(langCode)).findAny().orElse(null);

			if (returnLabel != null) {
				returnDto.setReturnName(returnLabel.getReturnLabel());
			} else {
				returnDto.setReturnName(returnsUploadDetails.getReturnObj().getReturnName());
			}

			List<ReturnFileFormatMap> returnFileFormatList = null;
			if (!CollectionUtils.isEmpty(returnsUploadDetails.getReturnObj().getReturnFileFormatMapList())) {
				returnFileFormatList = new ArrayList<>();
				for (ReturnFileFormatMap returnFileFormatMap : returnsUploadDetails.getReturnObj()
						.getReturnFileFormatMapList()) {
					ReturnFileFormatMap retFileFormatMap = new ReturnFileFormatMap();
					retFileFormatMap.setFileFormat(returnFileFormatMap.getFileFormat());
					retFileFormatMap.setJsonToReadFile(returnFileFormatMap.getJsonToReadFile());
					retFileFormatMap.setFormulaFileName(returnFileFormatMap.getFormulaFileName());
					returnFileFormatList.add(retFileFormatMap);
				}
				returnDto.setReturnFileFormatMapList(returnFileFormatList);
			}
			responseRetUploadDetBean.setReturnObj(returnDto);

			UploadChannel uploadChDto = new UploadChannel();
			uploadChDto.setUploadChannelDesc(
					returnsUploadDetails.getFileDetailsBean().getUploadChannelIdFk().getUploadChannelDesc());
			uploadChDto.setUploadChannelId(
					returnsUploadDetails.getFileDetailsBean().getUploadChannelIdFk().getUploadChannelId());
			responseRetUploadDetBean.setUploadChannel(uploadChDto);

			EntityBean entityDto = new EntityBean();

			EntityLabelBean entityLabelBean = returnsUploadDetails.getEntity().getEntityLabelSet().stream()
					.filter(f -> f.getLanguageMaster().getLanguageCode().equalsIgnoreCase(langCode)).findAny()
					.orElse(null);
			entityDto.setEntityId(returnsUploadDetails.getEntity().getEntityId());
			entityDto.setEntityCode(returnsUploadDetails.getEntity().getEntityCode());
			if (entityLabelBean != null) {
				entityDto.setEntityName(entityLabelBean.getEntityNameLabel());
			} else {
				entityDto.setEntityName(returnsUploadDetails.getEntity().getEntityName());
			}

			Category categoryDto = new Category();
			CategoryLabel cagtegoryLabel = returnsUploadDetails.getEntity().getCategory().getCatLblSet().stream()
					.filter(f -> f.getLangIdFk().getLanguageCode().equalsIgnoreCase(langCode)).findAny().orElse(null);
			if (cagtegoryLabel != null) {
				categoryDto.setCategoryName(cagtegoryLabel.getCategoryLabel());
			} else {
				categoryDto.setCategoryName(returnsUploadDetails.getEntity().getCategory().getCategoryName());
			}
			categoryDto.setCategoryCode(returnsUploadDetails.getEntity().getCategory().getCategoryCode());
			entityDto.setCategory(categoryDto);

			SubCategory subCatDto = new SubCategory();
			SubCategoryLabel subLabel = returnsUploadDetails.getEntity().getSubCategory().getSubCatLblSet().stream()
					.filter(f -> f.getLangIdFk().getLanguageCode().equalsIgnoreCase(langCode)).findAny().orElse(null);
			if (subLabel != null) {
				subCatDto.setSubCategoryName(subLabel.getSubCategoryLabel());
			} else {
				subCatDto.setSubCategoryName(returnsUploadDetails.getEntity().getSubCategory().getSubCategoryName());
			}
			subCatDto.setSubCategoryCode(returnsUploadDetails.getEntity().getSubCategory().getSubCategoryCode());
			entityDto.setSubCategory(subCatDto);

			responseRetUploadDetBean.setEntity(entityDto);

			UserMaster userDto = new UserMaster();
			userDto.setUserId(returnsUploadDetails.getUploadedBy().getUserId());
			userDto.setUserName(returnsUploadDetails.getUploadedBy().getUserName());
			responseRetUploadDetBean.setUploadedBy(userDto);

			if (returnsUploadDetails.getUnlockingReqId() != null) {
				UnlockingRequest unlockRequestDto = new UnlockingRequest();
				unlockRequestDto.setUnlockingReqId(returnsUploadDetails.getUnlockingReqId().getUnlockingReqId());
				unlockRequestDto.setUnlockStatus(returnsUploadDetails.getUnlockingReqId().getUnlockStatus());
				responseRetUploadDetBean.setUnlockingReqId(unlockRequestDto);
			}

			if (returnsUploadDetails.getRevisionRequestId() != null) {
				RevisionRequest revisionRequestDto = new RevisionRequest();
				revisionRequestDto
				.setRevisionRequestId(returnsUploadDetails.getRevisionRequestId().getRevisionRequestId());
				revisionRequestDto.setRevisionStatus(returnsUploadDetails.getRevisionRequestId().getReasonForRequest());
				responseRetUploadDetBean.setRevisionRequestId(revisionRequestDto);
			}
			if (returnsUploadDetails.getFileDetailsBean().getCreationDate() != null) {
				responseRetUploadDetBean
				.setUploadedOnInLong(returnsUploadDetails.getFileDetailsBean().getCreationDate().getTime());
			}

			responseRetUploadDetBean.setInstanceFile(returnsUploadDetails.getInstanceFile());

			if (returnsUploadDetails.getTaxonomyId() != null) {
				ReturnTemplate taxonomy = new ReturnTemplate();
				taxonomy.setReturnTemplateId(returnsUploadDetails.getTaxonomyId().getReturnTemplateId());
				taxonomy.setVersionDesc(returnsUploadDetails.getTaxonomyId().getVersionDesc());
				taxonomy.setVersionNumber(returnsUploadDetails.getTaxonomyId().getVersionNumber());
				taxonomy.setXsdFileName(returnsUploadDetails.getTaxonomyId().getXsdFileName());
				responseRetUploadDetBean.setTaxonomyId(taxonomy);
			}

			if (returnsUploadDetails.getUploadUsrRole() != null) {
				UserRole userRole = new UserRole();
				userRole.setUserRoleId(returnsUploadDetails.getUploadUsrRole().getRoleIdKey());
				userRole.setRoleDesc(returnsUploadDetails.getUploadUsrRole().getRoleDesc());
				userRole.setUserRoleId(returnsUploadDetails.getUploadUsrRole().getUserRoleId());
				responseRetUploadDetBean.setUploadUsrRole(userRole);
			}

			if (returnsUploadDetails.getFileType() != null) {
				responseRetUploadDetBean.setFileNameType(returnsUploadDetails.getFileType());
			}
			if (returnsUploadDetails.getFileDetailsBean() != null) {
				responseRetUploadDetBean.setFileName(returnsUploadDetails.getFileDetailsBean().getFileName());
			}
			if (returnsUploadDetails.getFileDetailsBean() != null) {
				responseRetUploadDetBean.setOriginalSupportiveDocName(returnsUploadDetails.getFileDetailsBean().getSupportiveDocName());
			}

			if (!UtilMaster.isEmpty(returnsUploadDetails.getAttachedFile())) {
				responseRetUploadDetBean.setAttachedFile(returnsUploadDetails.getAttachedFile());
			}

			WorkFlowMasterBean workflow = new WorkFlowMasterBean();
			workflow.setWorkflowId(returnsUploadDetails.getWorkFlowMaster().getWorkflowId());
			workflow.setWorkFlowJson(returnsUploadDetails.getWorkFlowMaster().getWorkFlowJson());

			responseRetUploadDetBean.setWorkFlowMaster(workflow);

			if (!Validations.isEmpty(returnsUploadDetails.getAttachedFile())) {
				responseRetUploadDetBean.setAttachedFile(returnsUploadDetails.getAttachedFile());
			}

			responseRetUploadDetBeanList.add(responseRetUploadDetBean);
		}

		return responseRetUploadDetBeanList;
	}
}